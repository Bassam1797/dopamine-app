<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dopamine 4-Week Plan</title>
<link rel="stylesheet" href="style.css" />
<link rel="manifest" href="manifest.json" />
</head>
<body>

<header>
  <h1>Dopamine 4-Week Plan</h1>
  <button id="darkToggle" title="Toggle Dark Mode">ðŸŒ™</button>
</header>

<main>

  <!-- Stats -->
  <section id="stats">
    <div>Streak: <span id="streak">0</span></div>

    <div>
      Day Score: <span id="score">0%</span>
      <div class="progress"><div id="barToday" class="fill"></div></div>
    </div>

    <div>
      Week Progress: <span id="weekProg">0%</span>
      <div class="progress"><div id="barWeek" class="fill"></div></div>
    </div>

    <svg height="80" width="80" aria-label="Today ring">
      <circle cx="40" cy="40" r="35" stroke="#e5e7eb" stroke-width="6" fill="none"/>
      <circle id="ringDaily" cx="40" cy="40" r="35" stroke="green" stroke-width="6" fill="none" stroke-dasharray="0,100" transform="rotate(-90 40 40)"/>
    </svg>
    <svg height="80" width="80" aria-label="Week ring">
      <circle cx="40" cy="40" r="35" stroke="#e5e7eb" stroke-width="6" fill="none"/>
      <circle id="ringWeek" cx="40" cy="40" r="35" stroke="blue" stroke-width="6" fill="none" stroke-dasharray="0,100" transform="rotate(-90 40 40)"/>
    </svg>
  </section>

  <!-- Date / Week Selector -->
  <section id="controls">
    <label for="weekSel">Week:</label>
    <select id="weekSel"></select>
    <label for="dateSel">Date:</label>
    <input type="date" id="dateSel" />
  </section>

  <!-- Actions & Rules -->
  <section>
    <h2>Actions</h2>
    <div id="actions"></div>
    <h2>Rules</h2>
    <div id="rules"></div>
  </section>

  <!-- Journal -->
  <section>
    <h2>Journal</h2>
    <textarea id="journal" rows="4" placeholder="Write your daily reflection..."></textarea>
    <div><button id="clearJournal">Clear</button></div>
  </section>

  <!-- Mood & Energy -->
  <section>
    <h2>Mood</h2>
    <div id="moodBtns"></div>
    <h2>Energy</h2>
    <div id="energyBtns"></div>
  </section>

  <!-- Tasks (dynamic) -->
  <section id="tasks">
    <h2>Tasks</h2>
    <div class="mut">Create tasks for today. Each task has its own timer.</div>

    <div id="tasksList"></div>

    <div class="task-actions">
      <button id="addTaskBtn">+ Add Task</button>
    </div>
  </section>

  <!-- Scheduled Tasks (auto-move to Today when due) -->
  <section id="scheduled">
    <h2>Scheduled Tasks</h2>
    <div class="mut">Tasks here will notify you and move into <em>Today</em> when their time arrives.</div>

    <form id="schedForm" autocomplete="off">
      <input type="text" id="schedText" placeholder="Task title" />
      <input type="date" id="schedDate" />
      <input type="time" id="schedTime" />
      <input type="number" id="schedMin" min="1" value="25" title="Minutes" />
      <select id="schedRepeat" title="Repeat">
        <option value="none">No repeat</option>
        <option value="daily">Daily</option>
        <option value="weekdays">Weekdays</option>
        <option value="weekly">Weekly</option>
      </select>
      <label class="checkbox-inline">
        <input type="checkbox" id="schedAutoStart" checked /> Auto-start
      </label>
      <button type="submit">Add</button>
    </form>

    <div id="scheduledList"></div>
  </section>

  <!-- Weekly Planner (next 7 days) -->
  <section id="planner">
    <h2>Weekly Planner</h2>
    <div class="mut">Upcoming scheduled tasks for the next 7 days.</div>
    <div id="plannerGrid" class="planner-grid"></div>
  </section>

  <!-- Timer -->
  <section>
    <h2>Timer</h2>
    <div>
      <button onclick="startTimer(25)">25m</button>
      <button onclick="startTimer(45)">45m</button>
      <button onclick="startTimer(60)">60m</button>
      <input type="number" id="customMins" placeholder="Custom (min)" style="width:100px" />
      <button onclick="startCustom()">Start</button>
      <button id="stopTimer">Stop</button>
    </div>
    <div id="timerDisplay"></div>
  </section>

  <!-- Completion & Badges -->
  <section>
    <button id="markComplete">Mark Day Complete</button>
    <div id="badges"></div>
  </section>

  <!-- Data Export / Import -->
  <section>
    <h2>Data</h2>
    <button onclick="exportJSON()">Export JSON</button>
    <button onclick="exportCSV()">Export CSV</button>
    <input type="file" id="importFile" accept=".json" />
  </section>

  <!-- Settings -->
  <section id="settings">
    <h2>Settings</h2>
    <div class="settings-row">
      <div>
        <div><strong>Start date:</strong> <span id="startDateLabel">â€”</span></div>
        <div><small class="mut">Auto week = floor(days since start Ã· 7) + 1.</small></div>
      </div>
      <div class="settings-actions">
        <button id="resetStartBtn" title="Reset start date to today">Reset to Today</button>
      </div>
    </div>
    <label class="toggle">
      <input type="checkbox" id="loopToggle" />
      Loop weeks after Week 4 (1â†’4â†’1â€¦)
    </label>
  </section>

</main>

<footer>
  <small>Offline-first PWA â€¢ All data stays on your device</small>
</footer>

<script src="app.js" defer></script>
</body>
</html>
